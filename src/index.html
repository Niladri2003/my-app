<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Hello World!</title>

</head>

<body>
  <h1>ðŸ’– Hello World!</h1>
  <p>Welcome to your Electron application.</p>
  <button id="startTunnel">Start Tunnel</button>
  <button id="stopTunnel">Stop Tunnel</button>
  
  <div id="tunnelData" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; border-radius: 5px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; background-color: #f5f5f5;">
    <p style="color: #999;">Tunnel data will appear here...</p>
  </div>

  <script>
    const start = document.getElementById('startTunnel');
    const stop = document.getElementById('stopTunnel');
    const tunnelDataDiv = document.getElementById('tunnelData');
    let pollingInterval = null;

    start.addEventListener('click', () => {
      window.api.startTunnel().then((response) => {
        console.log(response);
        alert(response.status);
        // Start polling tunnel list every 2 seconds
        if (pollingInterval) clearInterval(pollingInterval);
        pollingInterval = setInterval(() => {
          window.api.tunnelList().then((response) => {
            tunnelDataDiv.textContent = JSON.stringify(response, null, 2);
          }).catch((err) => {
            tunnelDataDiv.textContent = 'Error fetching tunnel list: ' + err.message;
          });
        }, 2000);
      });
    });
    // start.addEventListener('dblclick', () => {
    //   window.api.tunnelList().then((response) => {
    //     tunnelDataDiv.textContent = JSON.stringify(response, null, 2);
    //   });
    // });
    stop.addEventListener('click', () => {
      window.api.stopTunnel().then((response) => {
        console.log(response);
        alert(response.status);
        // Stop polling when tunnel is stopped
        if (pollingInterval) {
          clearInterval(pollingInterval);
          pollingInterval = null;
        }
        tunnelDataDiv.textContent = 'Tunnel stopped.';
      });
    });
  </script>
</body>

</html>